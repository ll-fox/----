{"version":3,"file":"login.js","sources":["pages/login/login.vue","pages/login/login.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<button class=\"login-btn\" @click=\"handleLogin\">微信登录</button>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tmethods: {\n\t\t\tasync handleLogin() {\n\t\t\t\ttry {\n\t\t\t\t\tconsole.log('开始获取用户信息')\n\t\t\t\t\tconst res = await uni.getUserProfile({\n\t\t\t\t\t\tdesc: '获取用户信息'\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\tif (!res || !res.userInfo) {\n\t\t\t\t\t\tthrow new Error('获取用户信息失败')\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('用户信息:', res.userInfo)\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('开始获取code')\n\t\t\t\t\tconst codeRes = await uni.login()\n\t\t\t\t\tif (codeRes.errMsg !== 'login:ok') {\n\t\t\t\t\t\tthrow new Error('获取code失败')\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log('获取到的code:', codeRes.code)\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('调用云函数登录')\n\t\t\t\t\tconst loginRes = await uniCloud.callFunction({\n\t\t\t\t\t\tname: 'wechat-login',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tcode: codeRes.code,\n\t\t\t\t\t\t\tuserInfo: res.userInfo\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tconsole.log('云函数返回:', loginRes)\n\t\t\t\t\t\n\t\t\t\t\tif (loginRes.result.code !== 0) {\n\t\t\t\t\t\tthrow new Error(loginRes.result.msg || '登录失败')\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 保存token和用户信息\n\t\t\t\t\tuni.setStorageSync('token', loginRes.result.token)\n\t\t\t\t\tuni.setStorageSync('userInfo', res.userInfo)\n\t\t\t\t\t\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '登录成功',\n\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\t// 跳转到首页\n\t\t\t\t\tuni.switchTab({\n\t\t\t\t\t\turl: '/pages/index/index'\n\t\t\t\t\t})\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('登录失败:', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: error.message || '登录失败，请重试',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.container {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\theight: 100vh;\n\t}\n\t\n\t.login-btn {\n\t\twidth: 200px;\n\t\theight: 40px;\n\t\tline-height: 40px;\n\t\tbackground-color: #07c160;\n\t\tcolor: #fff;\n\t\tborder-radius: 20px;\n\t}\n</style> ","import MiniProgramPage from '/Users/liulin/liulin/project/odd-system/单号系统/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAOC,MAAK,YAAU;AAAA,EACd,SAAS;AAAA,IACR,MAAM,cAAc;AACnB,UAAI;AACHA,sBAAAA,kDAAY,UAAU;AACtB,cAAM,MAAM,MAAMA,cAAG,MAAC,eAAe;AAAA,UACpC,MAAM;AAAA,SACN;AAED,YAAI,CAAC,OAAO,CAAC,IAAI,UAAU;AAC1B,gBAAM,IAAI,MAAM,UAAU;AAAA,QAC3B;AAEAA,sBAAA,MAAA,MAAA,OAAA,+BAAY,SAAS,IAAI,QAAQ;AAEjCA,sBAAAA,kDAAY,UAAU;AACtB,cAAM,UAAU,MAAMA,cAAG,MAAC,MAAM;AAChC,YAAI,QAAQ,WAAW,YAAY;AAClC,gBAAM,IAAI,MAAM,UAAU;AAAA,QAC3B;AACAA,sBAAY,MAAA,MAAA,OAAA,+BAAA,aAAa,QAAQ,IAAI;AAErCA,sBAAAA,kDAAY,SAAS;AACrB,cAAM,WAAW,MAAMC,cAAQ,GAAC,aAAa;AAAA,UAC5C,MAAM;AAAA,UACN,MAAM;AAAA,YACL,MAAM,QAAQ;AAAA,YACd,UAAU,IAAI;AAAA,UACf;AAAA,SACA;AACDD,sBAAAA,kDAAY,UAAU,QAAQ;AAE9B,YAAI,SAAS,OAAO,SAAS,GAAG;AAC/B,gBAAM,IAAI,MAAM,SAAS,OAAO,OAAO,MAAM;AAAA,QAC9C;AAGAA,sBAAAA,MAAI,eAAe,SAAS,SAAS,OAAO,KAAK;AACjDA,sBAAAA,MAAI,eAAe,YAAY,IAAI,QAAQ;AAE3CA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AAGDA,sBAAAA,MAAI,UAAU;AAAA,UACb,KAAK;AAAA,SACL;AAAA,MACA,SAAO,OAAO;AACfA,sBAAAA,MAAc,MAAA,SAAA,+BAAA,SAAS,KAAK;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,MAAM,WAAW;AAAA,UACxB,MAAM;AAAA,SACN;AAAA,MACF;AAAA,IACD;AAAA,EACD;AACD;;;;;;;AChED,GAAG,WAAW,eAAe;"}